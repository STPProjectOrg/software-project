services:
    web:
        image: "${WEB_IMAGE}"
        #command: gunicorn app.wsgi:application --bind 0.0.0.0:8000
        command: python manage.py runserver 0.0.0.0:8000
        volumes:
            - static_volume:/usr/src/app/staticfiles
            - media_volume:/usr/src/app/mediafiles
        ports:
            - 8000:8000
        env_file: .env
    redis:
        restart: unless-stopped
        image: redis:7.0.5-alpine
        command: redis-server
        ports:
            - 6379:6379

    worker_channels:
        build: ./app
        command: python manage.py runworker
        volumes:
            - ./app:/app
        links:
            - redis

    channels:
        image: "${WEB_IMAGE}"
        command: daphne -b 0.0.0.0 -p 8001 app.asgi:application
        ports:
            - 8001:8001
        links:
            - redis

volumes:
    static_volume:
    media_volume:
